[tool.mypy]
python_version = "3.11"
plugins = ["sqlalchemy.ext.mypy.plugin"]
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
exclude = "backend/api/alembic|backend/skills/.*/scripts|backend/scripts|backend/tests/skills"

[[tool.mypy.overrides]]
module = [
    "alembic.*",
    "anthropic",
    "boto3",
    "botocore.*",
    "bs4",
    "fastmcp",
    "fastmcp.*",
    "google",
    "google.*",
    "google.genai",
    "httpx",
    "jwt",
    "lxml",
    "markdownify",
    "ooxml",
    "playwright.sync_api",
    "prometheus_client",
    "pydantic_settings",
    "pydub",
    "readability",
    "sentry_sdk",
    "sentry_sdk.*",
    "yaml",
]
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = [
    "api.services.web_save_parser",
    "api.services.web_save_parser_cleanup",
    "api.services.web_save_parser_youtube",
    "api.services.web_save_rendering",
]
ignore_errors = true

[tool.ruff]
target-version = "py311"
exclude = ["backend/skills/**/scripts"]
extend-exclude = ["backend/api/alembic/versions", "backend/skills/**/scripts"]

[tool.ruff.lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort (import sorting)
    "N",   # pep8-naming
    "D",   # pydocstyle (docstrings)
    "UP",  # pyupgrade
    "B",   # flake8-bugbear
    "C4",  # flake8-comprehensions
    "T20", # flake8-print (no print statements)
    "SIM", # flake8-simplify
]

ignore = [
    "D104",  # Missing docstring in public package
    "D107",  # Missing docstring in __init__
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.per-file-ignores]
"**/__init__.py" = ["D104"]
"backend/api/alembic/env.py" = ["I001"]
"backend/api/alembic/versions/*.py" = ["D", "E501"]
"backend/api/auth.py" = ["B008"]
"backend/api/db/dependencies.py" = ["B008"]
"backend/api/routers/*.py" = ["B008"]
"backend/api/routers/files.py" = ["N803"]
"backend/api/routers/conversations.py" = ["N815"]
"backend/api/routers/ingestion_helpers.py" = ["E501"]
"backend/api/routers/tasks.py" = ["E501"]
"backend/api/routers/weather.py" = ["E501"]
"backend/api/routers/websites_helpers.py" = ["E501"]
"backend/api/services/settings_service.py" = ["E501"]
"backend/api/services/tools/definitions_fs.py" = ["E501"]
"backend/tests/**/*.py" = ["D", "T20", "SIM", "UP", "N806", "E501", "E402"]
"backend/workers/ingestion_worker.py" = ["D", "E501", "SIM", "UP"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
